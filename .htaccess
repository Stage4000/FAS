# Enable Rewrite Engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Force HTTPS (optional - uncomment if you have SSL)
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Prevent access to sensitive files
    RedirectMatch 403 ^/\.git
    RedirectMatch 403 ^/src/config/config\.php$
    RedirectMatch 403 ^/database/.*\.db$
    RedirectMatch 403 ^/composer\.(json|lock)$

    # Don't rewrite existing files and directories (includes images, CSS, JS, etc.)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Pretty URLs - Remove .php extension
    # Product detail pages MUST come before products listing to avoid conflicts
    # Product detail pages: /product/123 or /product/item-slug
    RewriteRule ^product/([0-9]+)/?$ product.php?id=$1 [L,QSA]
    
    # Products listing by category: /products/motorcycle (must come before general products)
    RewriteRule ^products/([a-zA-Z0-9_-]+)/?$ products.php?category=$1 [L,QSA]
    
    # Products listing: /products (must come after category to avoid conflicts)
    RewriteRule ^products/?$ products.php [L,QSA]
    
    # About page: /about
    RewriteRule ^about/?$ about.php [L,QSA]
    
    # Contact page: /contact
    RewriteRule ^contact/?$ contact.php [L,QSA]
    
    # Cart page: /cart
    RewriteRule ^cart/?$ cart.php [L,QSA]
    
    # Checkout page: /checkout
    RewriteRule ^checkout/?$ checkout.php [L,QSA]
    
    # Admin area - keep as-is (don't rewrite admin URLs)
    RewriteRule ^admin - [L]

    # Redirect .php URLs to extensionless versions (for external requests only)
    # But skip this for files in gallery, uploads, public directories
    RewriteCond %{THE_REQUEST} ^GET\ /(.*)\.php(\?.*)?\ HTTP
    RewriteCond %{REQUEST_URI} !^/(gallery|uploads|public|images|assets)/
    RewriteRule ^(.*)\.php$ /$1 [R=301,L]
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Prevent MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
</IfModule>

# PHP Settings (if allowed)
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>
